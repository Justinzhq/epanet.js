<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>epanet.js</title>
  
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="js/d3epanet.js"></script>
    
     <!-- Bootstrap header -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="css/bootstrap.min.css" rel="stylesheet"/>
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet"/>
    
    <link rel="stylesheet" href="css/d3epanet.css" />
  </head>
  <body>    
    <!-- Modal input -->
    <div id="inputModal" class="modal hide fade" tabindex="-1" role="dialog">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
            <h3 id="myModalLabel">Edit EPANET Model</h3>
        </div>
        <div class="modal-body">
            <textarea id="inputTextarea">[TITLE]
Simple epanet.js model

[JUNCTIONS] ; created by GHydraulics
PUMP1 25 0 
PUMP1dn 25 0 
J1 25   
G 0 351  
J0 25   

[RESERVOIRS] ; created by GHydraulics
R1 25  

[TANKS] ; created by GHydraulics

[PIPES] ; created by GHydraulics
P4 J1 G 740.791 100 0.1 0 OPEN 
P2 J0 PUMP1 2.208 100 0.1 0 OPEN 
P3 PUMP1dn J1 2.68 100 0.1 0 OPEN 
P1 R1 J0 1.052 100 0.1 0 OPEN 

[PUMPS] ; created by GHydraulics
PUMP1 PUMP1 PUMP1dn POWER 0.1 

[VALVES] ; created by GHydraulics

[TAGS]

[DEMANDS]
;Junction        	Demand      	Pattern         	Category

[STATUS]
;ID              	Status/Setting

[PATTERNS]
;ID              	Multipliers

[CURVES]
;ID              	X-Value     	Y-Value

[CONTROLS]

[RULES]

[ENERGY]
 Global Efficiency  	75
 Global Price       	0
 Demand Charge      	0

[EMITTERS]
;Junction        	Coefficient

[QUALITY]
;Node            	InitQual

[SOURCES]
;Node            	Type        	Quality     	Pattern

[REACTIONS]
;Type     	Pipe/Tank       	Coefficient


[REACTIONS]
 Order Bulk            	1
 Order Tank            	1
 Order Wall            	1
 Global Bulk           	0
 Global Wall           	0
 Limiting Potential    	0
 Roughness Correlation 	0

[MIXING]
;Tank            	Model

[TIMES]
 Duration           	0
 Hydraulic Timestep 	1:00
 Quality Timestep   	0:05
 Pattern Timestep   	1:00
 Pattern Start      	0:00
 Report Timestep    	1:00
 Report Start       	0:00
 Start ClockTime    	12 am
 Statistic          	None

[REPORT]
 Status             	Yes
 Summary                Yes
 Page               	0
 Nodes                  All
 Links                  All

[OPTIONS]
 Units              	CMD
 Headloss           	D-W
 Specific Gravity   	1
 Viscosity          	1
 Trials             	40
 Accuracy           	0.001
 CHECKFREQ          	2
 MAXCHECK           	10
 DAMPLIMIT          	0
 Unbalanced         	Continue 10
 Pattern            	1
 Demand Multiplier  	1.0
 Emitter Exponent   	0.5
 Quality            	None mg/L
 Diffusivity        	1
 Tolerance          	0.01

[COORDINATES] ; created by GHydraulics
PUMP1 10.1661784174 51.8015397878
PUMP1dn 10.1661922403 51.8015313179
J1 10.1662060632 51.8015228479
G 10.176376908 51.7997067163
J0 10.1661583145 51.8015552353
R1 10.1661502734 51.8015632765
[VERTICES] ; created by GHydraulics
P4 10.1665175862 51.8013427744
P4 10.1709055563 51.8008257206
P4 10.1721213314 51.8005741809
P4 10.1740358279 51.8004623855
P4 10.1763416084 51.7997357153
P2 10.1661784174 51.8015397878
[LABELS]
;X-Coord           Y-Coord          Label & Anchor Node

[BACKDROP]

[END]
            </textarea>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
            <button class="btn btn-primary" onclick="runButton()">Save changes</button>
        </div>
    </div>
      
    <!-- NAVBAR
    ================================================== -->
    <div class="navbar-wrapper">
      <!-- Wrap the .navbar in .container to center it within the absolutely positioned parent. -->
      <div class="container">

        <div class="navbar navbar-inverse">
          <div class="navbar-inner">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>  
            <a class="brand" href="#"  data-toggle="tooltip" title="App to run EPANET models in your browser (this page)">epanet.js</a>
            <div class="nav-collapse collapse">
              <ul class="nav">
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Samples <b class="caret"></b></a>
                  <ul class="dropdown-menu">                    
                    <li class="nav-header">EPANET</li>
                    <li><a href="javascript:loadSample('Net1.inp')">Net1.inp</a></li>
                    <li><a href="javascript:loadSample('Net2.inp')">Net2.inp</a></li>
                    <li><a href="javascript:loadSample('Net3.inp')">Net3.inp</a></li>
                    <li class="divider"></li>
                    <li class="nav-header">epanet.js</li>
                    <li><a href="javascript:loadSample('simple.inp')">simple.inp</a></li>
                    <li><a href="javascript:loadSample('PRV.inp')">PRV.inp</a></li>
                  </ul>
                </li>
                <li><a href="http://epanet.de/developer/epanetjs.html" data-toggle="tooltip" title="The epanet.js source code">Developers</a></li>
                <li><a href="http://epanet.de/" data-toggle="tooltip" title="The epanet.de home page">epanet.de</a></li>
              </ul><!-- .nav -->
            </div><!-- .nav-collapse -->   
          </div><!-- .navbar-inner -->
        </div><!-- .navbar -->

      </div> <!-- .container -->
    </div><!-- .navbar-wrapper -->



    <!-- Carousel
    ================================================== -->
    <div id="myCarousel" class="carousel slide">
      <div class="carousel-inner">
        <div class="item active">
          <svg id="svgSimple" width="100%" height="100%"></svg>
          <div class="container carousel-container">
            <div class="carousel-caption">
              <h1>Simple model</h1>              
              <p class="lead">Just lines and nodes</p>
            </div>
          </div>
        </div>
        <div class="item" id="analysis_model">
          <svg id="svgAnalysis" width="100%" height="100%"></svg>  
          <div class="container carousel-container">
            <div class="carousel-caption">             
              <h1>Detailed model</h2>
              <p class="lead">Polylines, nodes and labels</p>              
            </div>
          </div>
        </div>
      </div>
      <a class="left carousel-control" href="#myCarousel" data-slide="prev">&lsaquo;</a>
      <a class="right carousel-control" href="#myCarousel" data-slide="next">&rsaquo;</a>
    </div><!-- /.carousel -->


    <div class="container marketing">

      <!-- Three columns of text below the carousel -->
      <div class="row">
        <div class="span8">

          <h2>Input</h2>        
          <div class="btn-group" id="inputButtons">
              <input class="btn btn-larg" type="file" id="file" style="display: none" data-toggle="tooltip" title="File is kept locally in your browser. It is not sent to the server."/> 
              <a class="btn btn-large" href="javascript:saveButton()" data-toggle="tooltip" title="Save model in INP format.">Save</a>              
              <a href="#inputModal" role="button" class="btn btn-large" data-toggle="modal">Edit</a>
          </div>
           <pre id="inputPre" data-toggle="tooltip" title="Click to edit">
           </pre>          
        </div><!-- /.span8 -->
        <div class="span8">
          <h2>Analysis</h2>
          <div class="well well-small" id="status"><span class="label label-success">Success</span></div>         
          <pre id="output"></pre>
        </div><!-- /.span8 -->        
      </div><!-- /.row -->

      
      <!-- FOOTER -->
      <footer>
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p>&copy; 2013 Steffen Macke <a href="mailto:sdteffen@gmail.com">sdteffen@gmail.com</a> and others &middot; <a href="http://epanet.de/privacypolicy.html.en">Privacy</a> &middot; <a href="http://epanet.de/imprint.html.en">Imprint</a></p>
        <p>Epanet.de is not affiliated with or managed by the United States Environmental Protection Agency or any other governmental agency. </p>
      </footer>

    </div><!-- /.container -->


    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/FileSaver.min.js"></script>
    <script>
      !function ($) {
        $(function(){
          // carousel demo
          $('#myCarousel').carousel()
        })
      }(window.jQuery)
   
if(window.File && window.FileReader && window.FileList)
  document.getElementById('file').style.display = 'block';
function handleFileSelect(evt) {
  if(!evt.target || !evt.target.files || !evt.target.files.length || 0 == evt.target.files.length)
	return;
	
  var f = evt.target.files[0],
    reader = new FileReader();
  reader.onload = (function(theFile) {
            return function(e) {
              document.getElementById('inputTextarea').value = e.target.result;
	      runButton();
            };
          })(f);

  reader.readAsText(f);
}
document.getElementById('file').addEventListener('change', handleFileSelect, false);
$('#inputPre').on('click', function () {$('#inputModal').modal('show');});

      // connect to canvas
      var Module = {
        preRun: [],
        postRun: [],
        print: (function() {
          var element = document.getElementById('output');
          element.innerHTML = ''; // clear browser cache
          return function(text) {
            element.innerHTML += text + "\n";
            element.scrollTop = 99999; // focus on bottom
          };
        })(),
        printErr: function(text) {
          if (0) { // XXX disabled for safety typeof dump == 'function') {
            dump(text + '\n'); // fast, straight to the real console
          } else {
            console.log(text);
          }
        },
        canvas: document.getElementById('canvas'),
        setStatus: function(text) {
          
        },
        totalDependencies: 0,
        monitorRunDependencies: function(left) {
          this.totalDependencies = Math.max(this.totalDependencies, left);
          Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies-left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
        }
      };
      Module.setStatus('Preparing...');
    
      {{{ SCRIPT_CODE }}}

        </script>
    </body>
</html>
